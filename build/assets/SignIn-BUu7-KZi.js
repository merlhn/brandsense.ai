import{r as p,j as e,C,B as y,s as a,l as t,p as v,b as B,t as w,S as f}from"./index-DiUtmgPE.js";import{L as N,I as k}from"./label-GIWXnTsq.js";import{S as E}from"./separator-CJ6pKUll.js";import{A as P}from"./arrow-left-BNHGe6Af.js";import{L as D}from"./loader-circle-DqjRi6je.js";function $({onNavigate:l}){const[d,A]=p.useState(""),[u,S]=p.useState(""),[x,n]=p.useState(""),[o,c]=p.useState(!1),b=async()=>{if(!d||!u){n("Please enter your email and password");return}n(""),c(!0),t.cleanup("Clearing all storage data before sign in..."),a.clearAll();try{const r=await fetch(`https://${v}.supabase.co/functions/v1/make-server-cf9a9609/auth/signin`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${B}`},body:JSON.stringify({email:d.toLowerCase().trim(),password:u})}),s=await r.json();if(!r.ok){r.status===401?(t.cleanup("Authentication failed - clearing stale storage data"),a.clearAll(),s.error?.includes("check your credentials or sign up")?n("Invalid email or password. If you don't have an account, please sign up first."):n(s.error||"Invalid email or password. Please check your credentials.")):n(s.error||"Sign in failed. Please try again."),c(!1);return}if(!s.success||!s.accessToken){n("Sign in failed. Please try again."),c(!1);return}const g=s.user.email,m=s.user.fullName||"";a.setAccessToken(s.accessToken),a.setUserEmail(g),m&&a.setUserFullName(m),t.sync("Fetching projects from backend...");try{const h=await fetch(`https://${v}.supabase.co/functions/v1/make-server-cf9a9609/projects`,{headers:{Authorization:`Bearer ${s.accessToken}`}});if(h.ok){const i=(await h.json()).projects||[];t.success(`Fetched ${i.length} projects from backend`),i.length>0?(a.clearAllAndRestoreAuth(s.accessToken,g,m),a.syncProjectsFromBackend(i),t.success("User has projects, redirecting to dashboard"),w.success("Welcome back!",{description:`You have ${i.length} project${i.length>1?"s":""}. Click Refresh to load the latest data.`,duration:5e3}),c(!1),l?.(f.DASHBOARD)):(a.clearAllAndRestoreAuth(s.accessToken,g,m),t.info("No projects found - user can view dashboard (admin will create projects)"),w.success("Welcome to Brand Sense!",{description:"Get started by creating your first project to monitor your brand.",duration:5e3}),c(!1),l?.(f.DASHBOARD))}else t.error("Failed to fetch projects from backend"),a.clearAllAndRestoreAuth(s.accessToken),t.info("Backend fetch failed, redirecting to dashboard"),c(!1),l?.(f.DASHBOARD)}catch(h){t.error("Error fetching projects:",h),a.clearAllAndRestoreAuth(s.accessToken),t.info("Network error, redirecting to dashboard"),c(!1),l?.(f.DASHBOARD)}}catch(r){t.error("Sign in error:",r),n("Network error. Please check your connection and try again."),c(!1)}},j=r=>{r.key==="Enter"&&!o&&b()};return e.jsxs("div",{className:"w-full max-w-[400px] mx-auto",children:[e.jsxs("button",{onClick:()=>l?.("landing"),disabled:o,className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-8 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"tracking-tight",children:"Back"})]}),e.jsxs("div",{className:"mb-10",children:[e.jsx("h1",{className:"mb-3 text-foreground tracking-tight",children:"Sign In"}),e.jsx("p",{className:"text-muted-foreground",children:"Access your Brand Sense dashboard"})]}),x&&e.jsx("div",{className:"mb-6 p-4 border border-destructive/50 rounded-lg bg-destructive/10 space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{className:"w-5 h-5 text-destructive mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-destructive mb-2",children:x}),x.includes("Invalid email or password")&&e.jsxs("div",{className:"space-y-2 text-[13px]",children:[e.jsx("p",{className:"text-destructive/80 font-medium",children:"Most likely cause:"}),e.jsx("p",{className:"text-destructive/70 bg-destructive/5 p-2 rounded border border-destructive/20",children:`This account doesn't exist. Click "Sign Up" below to create a new account instead.`})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(y,{variant:"outline",disabled:!0,className:"w-full h-11 bg-card border-border opacity-50 cursor-not-allowed",children:[e.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google (Coming Soon)"]}),e.jsxs("div",{className:"relative my-6",children:[e.jsx(E,{className:"bg-border"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"bg-background px-3 text-muted-foreground uppercase tracking-wider",children:"or"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"email",className:"text-foreground",children:"Email"}),e.jsx(k,{id:"email",type:"email",placeholder:"you@company.com",value:d,onChange:r=>A(r.target.value),onKeyPress:j,disabled:o,className:"h-11 bg-card border-border focus:border-primary transition-colors"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{htmlFor:"password",className:"text-foreground",children:"Password"}),e.jsx("button",{onClick:()=>l?.("forgot"),disabled:o,className:"text-muted-foreground hover:text-foreground transition-colors disabled:opacity-50",children:"Forgot?"})]}),e.jsx(k,{id:"password",type:"password",placeholder:"••••••••",value:u,onChange:r=>S(r.target.value),onKeyPress:j,disabled:o,className:"h-11 bg-card border-border focus:border-primary transition-colors"})]}),e.jsx(y,{onClick:b,disabled:!d||!u||o,className:"w-full h-11 mt-6 bg-primary hover:bg-primary/90 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:o?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2 animate-spin"}),"Signing In..."]}):"Sign In"})]}),e.jsxs("div",{className:"text-center mt-8 pt-6 border-t border-border",children:[e.jsx("span",{className:"text-muted-foreground",children:"Don't have an account?"}),e.jsx("button",{onClick:()=>l?.("signup"),disabled:o,className:"text-foreground hover:text-primary transition-colors disabled:opacity-50",children:"Sign Up"})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>{confirm("This will clear all local data including saved projects. Are you sure?")&&(a.clearAll(),window.location.reload())},className:"text-muted-foreground/60 hover:text-muted-foreground transition-colors text-[13px]",children:"Clear All Data"})})]})]})}export{$ as SignIn};
